# ç¬¬ 1 éƒ¨åˆ† å¤§å‚è§„èŒƒ

## ç¬¬01èŠ‚ï¼šå¤§å‚ç å†œå¼€å‘åŸºç¡€

<img src="E:\Document\Typoraç¬”è®°\Pictures\åŸºç¡€å†…å®¹ä»‹ç».png" alt="åŸºç¡€å†…å®¹ä»‹ç»" style="zoom:150%;" />



## ç¬¬02èŠ‚ï¼šéœ€æ±‚æ€ä¹ˆæ¥çš„

<img src="E:\Document\Typoraç¬”è®°\Pictures\éœ€æ±‚æ€ä¹ˆæ¥çš„.png" alt="éœ€æ±‚æ€ä¹ˆæ¥çš„" style="zoom:150%;" />



## ç¬¬03èŠ‚ï¼šç³»ç»Ÿæ¶æ„è®¾è®¡

<img src="E:\Document\Typoraç¬”è®°\Pictures\ç³»ç»Ÿæ¶æ„è®¾è®¡.png" alt="ç³»ç»Ÿæ¶æ„è®¾è®¡" style="zoom: 200%;" />



## ç¬¬04èŠ‚ï¼šè¿›å…¥å¼€å‘é˜¶æ®µ

<img src="E:\Document\Typoraç¬”è®°\Pictures\è¿›å…¥å¼€å‘é˜¶æ®µ.png" alt="è¿›å…¥å¼€å‘é˜¶æ®µ"  />



## ç¬¬05èŠ‚ï¼šç³»ç»Ÿä¸Šçº¿ç»´æŠ¤

![ç³»ç»Ÿä¸Šçº¿ç»´æŠ¤](E:\Document\Typoraç¬”è®°\Pictures\ç³»ç»Ÿä¸Šçº¿ç»´æŠ¤.png)



# ç¬¬ 2 éƒ¨åˆ† é¢†åŸŸå¼€å‘

## ç¬¬01èŠ‚ï¼šç¯å¢ƒã€é…ç½®ã€è§„èŒƒ

## ç¬¬02èŠ‚ï¼šæ­å»ºDDDå››å±‚æ¶æ„

> - åˆ†æ”¯ï¼š230504_neil_initProject
> - ç›®çš„ï¼šæ­å»ºå·¥ç¨‹ç»“æ„

**DDDåˆ†å±‚æ¶æ„ä»‹ç»**

![2-02](E:\Document\Typoraç¬”è®°\Pictures\2-02.png)

- åº”ç”¨å±‚{application}
- é¢†åŸŸå±‚{domain}
- åŸºç¡€å±‚{infrastructure}
- æ¥å£å±‚{interfaces}

**DDD + RPCï¼Œæ¨¡å—åˆ†ç¦»ç³»ç»Ÿæ­å»º**

![2-03](E:\Document\Typoraç¬”è®°\Pictures\2-03.png)

**ä¸ºä»€ä¹ˆè¦æŠŠRPCå±‚å•ç‹¬æ‹†åˆ†å‡ºæ¥**

ä½¿ç”¨ RPC æ¡†æ¶çš„æ—¶å€™ï¼Œéœ€è¦å¯¹å¤–æä¾›æè¿°æ¥å£ä¿¡æ¯çš„ Jar è®©å¤–éƒ¨è°ƒç”¨æ–¹å¼•å…¥æ‰å¯ä»¥é€šè¿‡åå°„è°ƒç”¨åˆ°å…·ä½“çš„æ–¹æ³•æä¾›è€…ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™ï¼ŒRPC éœ€è¦æš´éœ²å‡ºæ¥ï¼Œè€Œ DDD çš„ç³»ç»Ÿç»“æ„åˆæ¯”è¾ƒè€¦åˆï¼Œæ€ä¹ˆè¿›è¡Œæ¨¡å—åŒ–çš„åˆ†ç¦»å°±æˆäº†é—®é¢˜ç‚¹ã€‚

### 2.2 é¡¹ç›®å®ç°

1. é€šè¿‡gitåˆ›å»ºæ–°çš„é¡¹ç›®ï¼Œä½¿ç”¨sshæˆ–è€…ç”¨æˆ·å¯†ç ç™»å½•å°†é¡¹ç›®cloneåˆ°æœ¬åœ°

   - æ£€æŸ¥Gitæ˜¯å¦å·²ç»æœ‰SSHå¯†é’¥ï¼Œæ²¡æœ‰è¿›è¡Œç”Ÿæˆ[(104æ¡æ¶ˆæ¯) Git ä½¿ç”¨ â€”è®¾ç½® Git çš„SSHç§˜é’¥_gité…ç½®sshå¯†é’¥_åµŒå…¥å¼ä¹‹å…¥å‘ç¬”è®°çš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/weixin_43866583/article/details/125680653)

   - å°†å¯†é’¥æ·»åŠ åˆ°å¯¹åº”çš„gitcodeä¸­

     ![image-20230505142103597](E:\Document\Typoraç¬”è®°\Pictures\image-20230505142103597.png)

2. æŒ‰ç…§å¯¹åº”ç»“æ„åˆ›å»ºå¯¹åº”çš„module

   ![image-20230505142229618](E:\Document\Typoraç¬”è®°\Pictures\image-20230505142229618.png)




## ç¬¬03èŠ‚ï¼šè·‘é€šå¹¿æ’­æ¨¡å¼RPCè¿‡ç¨‹è°ƒç”¨

### 3.1 åˆ›å»ºæŠ½å¥–æ´»åŠ¨è¡¨

- å®‰è£…`mysql`å’Œ`Navicat`ï¼ˆå¦‚æœä¹‹å‰æœ‰å®‰è£…mysqlå’Œnavicatï¼Œä¸€å®šè¦å¸è½½å¹²å‡€ï¼‰ï¼Œè¿æ¥Navicat

  [MySQL 8.0ä¿å§†çº§ä¸‹è½½ã€å®‰è£…åŠé…ç½®æ•™ç¨‹ï¼ˆæˆ‘å¦ˆçœ‹äº†éƒ½èƒ½å­¦ä¼šï¼‰_å“”å“©å“”å“©_bilibili](https://www.bilibili.com/video/BV12q4y1477i/?spm_id_from=333.880.my_history.page.click&vd_source=b1ff0fefaa80f9539a2f636f1d95bd71)

- ä½¿ç”¨ideaä¸­çš„databaseåˆ›å»º`æ´»åŠ¨è¡¨`

  ```sql
  CREATE TABLE `activity` (
    `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'è‡ªå¢ID',
    `activity_id` bigint(20) NOT NULL COMMENT 'æ´»åŠ¨ID',
    `activity_name` varchar(64) CHARACTER SET utf8mb4 DEFAULT NULL COMMENT 'æ´»åŠ¨åç§°',
    `activity_desc` varchar(128) CHARACTER SET utf8mb4 DEFAULT NULL COMMENT 'æ´»åŠ¨æè¿°',
    `begin_date_time` datetime DEFAULT NULL COMMENT 'å¼€å§‹æ—¶é—´',
    `end_date_time` datetime DEFAULT NULL COMMENT 'ç»“æŸæ—¶é—´',
    `stock_count` int(11) DEFAULT NULL COMMENT 'åº“å­˜',
    `take_count` int(11) DEFAULT NULL COMMENT 'æ¯äººå¯å‚ä¸æ¬¡æ•°',
    `state` tinyint(2) DEFAULT NULL COMMENT 'æ´»åŠ¨çŠ¶æ€ï¼š1ç¼–è¾‘ã€2æå®¡ã€3æ’¤å®¡ã€4é€šè¿‡ã€5è¿è¡Œ(å®¡æ ¸é€šè¿‡åworkeræ‰«æçŠ¶æ€)ã€6æ‹’ç»ã€7å…³é—­ã€8å¼€å¯',
    `creator` varchar(64) CHARACTER SET utf8mb4 DEFAULT NULL COMMENT 'åˆ›å»ºäºº',
    `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT 'ä¿®æ”¹æ—¶é—´',
    PRIMARY KEY (`id`),
    UNIQUE KEY `unique_activity_id` (`activity_id`)
  ) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin COMMENT='æ´»åŠ¨é…ç½®';
  ```

**å‡ºç°é—®é¢˜**

1. MysqlæœåŠ¡æ— æ³•è‡ªå¯åŠ¨

   > åƒåœ¾æ ¡å›­ç½‘ï¼Œæ¯æ¬¡å¼€æœºéƒ½æ–­ç½‘ï¼Œè¿˜ä»¥ä¸ºæ˜¯æœåŠ¡ç®¡ç†å™¨çš„é—®é¢˜

   [(105æ¡æ¶ˆæ¯) MySQLæœåŠ¡æ— æ³•è‡ªå¯åŠ¨_mysqlæœåŠ¡æ— æ³•è‡ªåŠ¨å¯åŠ¨_Ğ•Ğ½Ğ¾Ñ…-ç‡šçš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/qq_54515850/article/details/126448534)

   [(105æ¡æ¶ˆæ¯) mysqlè®¾ç½®å¼€æœºè‡ªå¯åä¾ç„¶æ— æ³•è‡ªå¯åŠ¨_æ˜¯ç§ƒå¤´ç»ˆä¼šå‘å…‰çš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/weixin_46030885/article/details/128440800)

   [(105æ¡æ¶ˆæ¯) MySQLå¼€æœºæ— æ³•å¯åŠ¨ï¼Œéœ€æ‰‹åŠ¨å¯åŠ¨æ‰å¯ä»¥ã€‚_mysqlæ¯æ¬¡éƒ½è¦æ‰‹åŠ¨å¯åŠ¨_æ ¼æ—-scorpioçš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/pengwupeng2008/article/details/125551926?spm=1001.2101.3001.6650.1&utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-1-125551926-blog-126448534.235^v32^pc_relevant_default_base3&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-1-125551926-blog-126448534.235^v32^pc_relevant_default_base3&utm_relevant_index=2&ydreferer=aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzU0NTE1ODUwL2FydGljbGUvZGV0YWlscy8xMjY0NDg1MzQ%3D)

### 3.2 POMæ–‡ä»¶é…ç½®

- æ€»å·¥ç¨‹ä¸‹ä¸é…ä»»ä½•ä¾èµ–

- æ¨¡å—ç±»POMé…ç½®ä¸­ç¡®ä»€ä¹ˆè¡¥ä»€ä¹ˆï¼Œæ¯ä¸ªæ¨¡å—éƒ½ä¾èµ–`common`

  ```xml
  <dependencies>
      <dependency>
          <groupId>cn.itedus.lottery</groupId>
          <artifactId>lottery-common</artifactId>
          <version>1.0-SNAPSHOT</version>
      </dependency>
  </dependencies>
  ```

  

- waråŒ…pomé…ç½®ï¼šlottery-interfaces æ˜¯æ•´ä¸ªç¨‹åºçš„å‡ºå£ï¼Œä¹Ÿæ˜¯ç”¨äºæ„å»º War åŒ…çš„å·¥ç¨‹æ¨¡å—ï¼Œæ‰€ä»¥ä½ ä¼šçœ‹åˆ°ä¸€ä¸ª `<packaging>war</packaging>` çš„é…ç½®

### 3.3 é…ç½®Mybatis

- interfacesä¸­çš„mysqlä¾èµ–è¦å’Œä¸‹è½½çš„mysqlç‰ˆæœ¬å¯¹åº”ä¸Š

  ```xml
          <dependency>
              <groupId>mysql</groupId>
              <artifactId>mysql-connector-java</artifactId>
              <version>8.0.33</version>
          </dependency>
  ```

- é…ç½®yml

  > è‹¥æœ¬åœ°æ˜¯MySQL8ç‰ˆæœ¬ï¼Œå¯åŠ¨é¡¹ç›®å‰è®°å¾—å°†lottery-interfacesæ¨¡å—ä¸‹çš„pomæ–‡ä»¶mysql-connector-java éƒ¨åˆ†ç‰ˆæœ¬å·å‡çº§ä¸º8.0.22 ã€‚å¹¶åœ¨è¯¥æ¨¡å—ä¸‹çš„ymlé…ç½®æ–‡ä»¶ä¸­å°†driver-class-name è°ƒæ•´ä¸ºcom.mysql.cj.jdbc.Driver ï¼Œä¸”å› ä¸ºMySQL8è¿æ¥è¦æ±‚ï¼Œå¿…é¡»åœ¨è¿æ¥urlåè·Ÿä¸ŠserverTimezone çš„é…ç½®ï¼Œå³url: jdbc:mysql://127.0.0.1:3306/lottery?useUnicode=true&serverTimezone=Asia/Shanghai

  ```yml
  server:
    port: 8080
  
  spring:
    datasource:
      username: root
      password: 123456
      url: jdbc:mysql://127.0.0.1:3306/lottery?useUnicode=true&serverTimezone=Asia/Shanghai
      driver-class-name: com.mysql.cj.jdbc.Driver
  
  mybatis:
    mapper-locations: classpath:/mybatis/mapper/*.xml
    config-location:  classpath:/mybatis/config/mybatis-config.xml
  ```

**æµ‹è¯•**

```java
@Slf4j
@RunWith(SpringRunner.class)
@SpringBootTest
public class ApiTest {

    @Resource
    IActivityDao activityDao;

    @Test
    public void test_insert(){
        Activity activity = new Activity();
        activity.setActivityId(100001L);
        activity.setActivityName("æµ‹è¯•æ´»åŠ¨");
        activity.setActivityDesc("ä»…ç”¨äºæ’å…¥æ•°æ®æµ‹è¯•");
        activity.setBeginDateTime(new Date());
        activity.setEndDateTime(new Date());
        activity.setStockCount(100);
        activity.setTakeCount(10);
        activity.setState(0);
        activity.setCreator("neilnan");
        activityDao.insert(activity);
    }

    @Test
    public void test_select(){
        Activity activity = activityDao.queryActivityById(100001L);
        log.info("æµ‹è¯•ç»“æœï¼š{}", JSON.toJSONString(activity));
    }
}
```

### 3.4é…ç½®å¹¿æ’­æ¨¡å¼Dubbo

- é…ç½®yml

  ```yml
  # Dubbo å¹¿æ’­æ–¹å¼é…ç½®
  dubbo:
    application:
      name: Lottery
      version: 1.0.0
    registry:
      address: N/A #multicast://224.5.6.7:1234
    protocol:
      name: dubbo
      port: 20880
    scan:
      base-packages: cn.itedus.lottery.rpc
  ```

  > - å¹¿æ’­æ¨¡å¼çš„é…ç½®å”¯ä¸€åŒºåˆ«åœ¨äºæ³¨å†Œåœ°å€ï¼Œregistry.address = multicast://224.5.6.7:1234ï¼ŒæœåŠ¡æä¾›è€…å’ŒæœåŠ¡è°ƒç”¨è€…éƒ½éœ€è¦é…ç½®ç›¸åŒçš„ğŸ“¢å¹¿æ’­åœ°å€ã€‚æˆ–è€…é…ç½®ä¸º N/A ç”¨äºç›´è¿æ¨¡å¼ä½¿ç”¨
  > - applicationï¼Œé…ç½®åº”ç”¨åç§°å’Œç‰ˆæœ¬
  > - protocolï¼Œé…ç½®çš„é€šä¿¡åè®®å’Œç«¯å£
  > - scanï¼Œç›¸å½“äº Spring ä¸­è‡ªåŠ¨æ‰«æåŒ…çš„åœ°å€ï¼Œå¯ä»¥æŠŠæ­¤åŒ…ä¸‹çš„æ‰€æœ‰ rpc æ¥å£éƒ½æ³¨å†Œåˆ°æœåŠ¡ä¸­

- è¿™é‡Œæ³¨æ„å¼•ç”¨ä¾èµ–çš„ç‰ˆæœ¬è¦ç›¸åŒ

  ```xml
          <dependency>
              <groupId>org.apache.dubbo</groupId>
              <artifactId>dubbo</artifactId>
              <version>2.7.1</version>
          </dependency>
          <dependency>
              <groupId>org.apache.dubbo</groupId>
              <artifactId>dubbo-spring-boot-starter</artifactId>
              <version>2.7.1</version>
          </dependency>
  ```

### 3.5å®šä¹‰å’Œå¼€å‘RPCæ¥å£

> ç”±äº RPC æ¥å£åœ¨é€šä¿¡çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦æä¾›æ¥å£çš„æè¿°æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯æ¥å£çš„å®šä¹‰ä¿¡æ¯ã€‚æ‰€ä»¥è¿™é‡Œä½ ä¼šçœ‹åˆ°æˆ‘ä»¬ä¼šæŠŠæ‰€æœ‰çš„ RPC æ¥å£å®šä¹‰éƒ½æ”¾åˆ° `lottery-rpc` æ¨¡å—ä¸‹ï¼Œè¿™ç§æ–¹å¼çš„ä½¿ç”¨è®©å¤–éƒ¨å°±åªä¾èµ–è¿™æ ·ä¸€ä¸ª pom é…ç½®å¼•å…¥çš„ Jar åŒ…å³å¯ã€‚

1. **å®šä¹‰æ¥å£**

   ```java
   public interface IActivityBooth {
       ActivityRes queryActivityById(ActivityReq req);
   }
   ```

2. **å¼€å‘æ¥å£**

   ```java
   @Service
   public class ActivityBooth implements IActivityBooth {
   
       @Resource
       private IActivityDao activityDao;
   
       @Override
       public ActivityRes queryActivityById(ActivityReq req){
   
           Activity activity = activityDao.queryActivityById(req.getActivityId());
   
           ActivityDto activityDto = new ActivityDto();
           activityDto.setActivityId(activity.getActivityId());
           activityDto.setActivityName(activity.getActivityName());
           activityDto.setActivityDesc(activity.getActivityDesc());
           activityDto.setBeginDateTime(activity.getBeginDateTime());
           activityDto.setEndDateTime(activity.getEndDateTime());
           activityDto.setStockCount(activity.getStockCount());
           activityDto.setTakeCount(activity.getTakeCount());
   
           return new ActivityRes(new Result(Constants.ResponseCode.SUCCESS.getCode(), Constants.ResponseCode.SUCCESS.getInfo()), activityDto);
       }
   }
   ```

   > - ç”¨äºå®ç° RPC æ¥å£çš„å®ç°ç±» ActivityBooth ä¸Šæœ‰ä¸€ä¸ªæ³¨è§£ @Serviceï¼Œè¿™ä¸ªæ³¨è§£æ˜¯æ¥è‡ªäº Dubbo çš„ `org.apache.dubbo.config.annotation.Service`ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªåŒ…ä¸‹å«æœ‰æ­¤æ³¨è§£é…ç½®çš„ç±»å¯ä»¥è¢« Dubbo ç®¡ç†ã€‚
   > - åœ¨ queryActivityById åŠŸèƒ½å®ç°ä¸­ç›®å‰è¿˜æ¯”è¾ƒç²—ç³™ï¼Œä½†å¤§ä½“å¯ä»¥çœ‹å‡ºè¿™æ˜¯å¯¹æ•°æ®åº“çš„æ“ä½œä»¥åŠå¯¹ç»“æœçš„å°è£…ï¼Œæä¾› DTO çš„å¯¹è±¡å¹¶è¿”å› Res ç»“æœã€‚*ç›®å‰dtoçš„åˆ›å»ºåç»­å¯ä»¥ä½¿ç”¨é—¨é¢æ¨¡å¼å’Œå·¥å…·ç±»è¿›è¡Œå¤„ç†*

### 3.6æ­å»ºæµ‹è¯•å·¥ç¨‹è°ƒç”¨RPC

- æµ‹è¯•ä¹‹å‰éœ€è¦æŠŠ Lottery å·¥ç¨‹ä¸­çš„ lottery-rpc è¿›è¡Œæ„å»ºæ‰“åŒ…ï¼Œä¾¿äºæµ‹è¯•å·¥ç¨‹å¼•å…¥

  ![3-03](E:\Document\Typoraç¬”è®°\Pictures\3-03.png)

- åœ¨ç»Ÿä¸€å¹¿æ’­åœ°å€ä¸‹ä½¿ç”¨

- å•å…ƒæµ‹è¯•

  ```java 
  @RunWith(SpringRunner.class)
  @SpringBootTest
  public class ApiTest {
  
      private Logger logger = LoggerFactory.getLogger(ApiTest.class);
  
      @Reference(interfaceClass = IActivityBooth.class, url = "dubbo://127.0.0.1:20880")
      private IActivityBooth activityBooth;
  
      @Test
      public void test_rpc() {
          ActivityReq req = new ActivityReq();
          req.setActivityId(100001L);
          ActivityRes result = activityBooth.queryActivityById(req);
          logger.info("æµ‹è¯•ç»“æœï¼š{}", JSON.toJSONString(result));
      }
  
  }
  ```

### é—®é¢˜

- mybatisä¸­select `resultType`å’Œ`resultMap`çš„ä¸åŒ
- Serializableæ¥å£çš„ä½œç”¨
- å¼‚å¸¸åˆ†ç±»

> Java æ–‡ä»¶ä¸­çš„ IActivityBooth æ¥å£æ˜¯ä¸€ä¸ªè¿œç¨‹æœåŠ¡æ¥å£ï¼Œå®ƒå®šä¹‰äº†å®¢æˆ·ç«¯å¯ä»¥è¿œç¨‹è°ƒç”¨çš„æ–¹æ³•ã€‚ActivityBooth ç±»å®ç°æ­¤æ¥å£å¹¶æä¾› queryActivityById æ–¹æ³•çš„å®ç°ã€‚æ­¤æ–¹æ³•æ¥å— ActivityReq å¯¹è±¡ä½œä¸ºè¾“å…¥ï¼Œå¹¶è¿”å› ActivityRes å¯¹è±¡ä½œä¸ºè¾“å‡ºã€‚è¯¥æ–¹æ³•ä½¿ç”¨ activityDao å¯¹è±¡ä»æ•°æ®åº“æŸ¥è¯¢ Activity å¯¹è±¡ï¼Œå¹¶å°† Activity å¯¹è±¡çš„å±æ€§æ˜ å°„åˆ° ActivityDto å¯¹è±¡çš„ç›¸åº”å±æ€§ã€‚æœ€åï¼Œå®ƒè¿”å›ä¸€ä¸ªåŒ…å« ActivityDto å¯¹è±¡çš„ ActivityRes å¯¹è±¡å’Œä¸€ä¸ªåŒ…å«æˆåŠŸçŠ¶æ€ä»£ç å’Œæ¶ˆæ¯çš„ Result å¯¹è±¡ã€‚
>
> Java æ–‡ä»¶ä¸­çš„ Result ç±»æ˜¯ä¸€ä¸ªè¡¨ç¤ºå“åº”çŠ¶æ€çš„ç®€å•åŒ…è£…ç±»ã€‚å®ƒåŒ…å«çŠ¶æ€ä»£ç çš„æ•´æ•°ä»£ç å±æ€§å’ŒçŠ¶æ€æ¶ˆæ¯çš„å­—ç¬¦ä¸² info å±æ€§ã€‚è¿™ä¸ªç±»çš„ç›®çš„æ˜¯ä½¿å¾—åœ¨åº”ç”¨ç¨‹åºä¸­çš„å„ç§è¿œç¨‹æœåŠ¡æ–¹æ³•ä¹‹é—´è¿”å›ä¸€è‡´çš„å“åº”çŠ¶æ€ä¿¡æ¯å˜å¾—å®¹æ˜“ã€‚



## ç¬¬04èŠ‚ï¼šæŠ½å¥–æ´»åŠ¨ç­–ç•¥åº“è¡¨è®¾è®¡

### 4.1 å»ºè¡¨é€»è¾‘

![4-01](E:\Document\Typoraç¬”è®°\Pictures\4-01.png)

![æŠ½å¥–æ´»åŠ¨ç­–ç•¥åº“è¡¨è®¾è®¡](E:\Document\Typoraç¬”è®°\Pictures\æŠ½å¥–æ´»åŠ¨ç­–ç•¥åº“è¡¨è®¾è®¡.png)

- æ´»åŠ¨é…ç½®ï¼Œactivityï¼šæä¾›æ´»åŠ¨çš„åŸºæœ¬é…ç½®
- ç­–ç•¥é…ç½®ï¼Œstrategyï¼šç”¨äºé…ç½®æŠ½å¥–ç­–ç•¥ï¼Œæ¦‚ç‡ï¼Œç©æ³•ï¼Œåº“å­˜ï¼Œå¥–å“
- ç­–ç•¥æ˜ç»†ï¼Œstrategy_detailï¼šæŠ½å¥–ç­–ç•¥çš„å…·ä½“æ˜ç»†é…ç½®
- å¥–å“é…ç½®ï¼Œawardï¼šç”¨äºé…ç½®å…·ä½“å¯ä»¥å¾—åˆ°çš„å¥–å“
- ç”¨æˆ·å‚ä¸æ´»åŠ¨è®°å½•è¡¨ï¼Œuser_take_activityï¼šæ¯ä¸ªç”¨æˆ·å‚ä¸æ´»åŠ¨éƒ½ä¼šè®°å½•ä¸‹ä»–çš„å‚ä¸ä¿¡æ¯ï¼Œæ—¶é—´ï¼Œæ¬¡æ•°
- ç”¨æˆ·æ´»åŠ¨å‚ä¸æ¬¡æ•°è¡¨ï¼Œuser_take_activity_countï¼šç”¨äºè®°å½•å½“å‰å‚ä¸äº†å¤šå°‘æ¬¡
- ç”¨æˆ·ç­–ç•¥è®¡ç®—ç»“æœè¡¨ï¼Œuser_strategy_export_001~004ï¼šæœ€ç»ˆç­–ç•¥ç»“æœçš„ä¸€ä¸ªè®°å½•ï¼Œä¹Ÿå°±æ˜¯å¥–å“ä¸­å¥–ä¿¡æ¯çš„å†…å®¹



### 4.2 å»ºè¡¨è¯­å¥

lottery.sql

```sql
create database lottery;

-- auto-generated definition
create table activity
(
    id            bigint auto_increment comment 'è‡ªå¢ID',
    activityId    bigint       null comment 'æ´»åŠ¨ID',
    activityName  varchar(64)  not null comment 'æ´»åŠ¨åç§°',
    activityDesc  varchar(128) null comment 'æ´»åŠ¨æè¿°',
    beginDateTime datetime     not null comment 'å¼€å§‹æ—¶é—´',
    endDateTime   datetime     not null comment 'ç»“æŸæ—¶é—´',
    stockCount    int          not null comment 'åº“å­˜',
    takeCount     int          null comment 'æ¯äººå¯å‚ä¸æ¬¡æ•°',
    state         int          null comment 'æ´»åŠ¨çŠ¶æ€ï¼šç¼–è¾‘ã€æå®¡ã€æ’¤å®¡ã€é€šè¿‡ã€è¿è¡Œã€æ‹’ç»ã€å…³é—­ã€å¼€å¯',
    creator       varchar(64)  not null comment 'åˆ›å»ºäºº',
    createTime    datetime     not null comment 'åˆ›å»ºæ—¶é—´',
    updateTime    datetime     not null comment 'ä¿®æ”¹æ—¶é—´',
    constraint activity_id_uindex
        unique (id)
)
    comment 'æ´»åŠ¨é…ç½®';

alter table activity
    add primary key (id);

-- auto-generated definition
create table award
(
    id           bigint(11) auto_increment comment 'è‡ªå¢ID'
        primary key,
    awardId      bigint                             null comment 'å¥–å“ID',
    awardType    int(4)                             null comment 'å¥–å“ç±»å‹ï¼ˆæ–‡å­—æè¿°ã€å…‘æ¢ç ã€ä¼˜æƒ åˆ¸ã€å®ç‰©å¥–å“æš‚æ— ï¼‰',
    awardCount   int                                null comment 'å¥–å“æ•°é‡',
    awardName    varchar(64)                        null comment 'å¥–å“åç§°',
    awardContent varchar(128)                       null comment 'å¥–å“å†…å®¹ã€Œæ–‡å­—æè¿°ã€Keyã€ç ã€',
    createTime   datetime default CURRENT_TIMESTAMP null comment 'åˆ›å»ºæ—¶é—´',
    updateTime   datetime default CURRENT_TIMESTAMP null comment 'updateTime'
)
    comment 'å¥–å“é…ç½®';

-- auto-generated definition
create table strategy
(
    id           bigint(11) auto_increment comment 'è‡ªå¢ID'
        primary key,
    strategyId   bigint(11)   not null comment 'ç­–ç•¥ID',
    strategyDesc varchar(128) null comment 'ç­–ç•¥æè¿°',
    strategyMode int(4)       null comment 'ç­–ç•¥æ–¹å¼ã€Œ1:å•é¡¹æ¦‚ç‡ã€2:æ€»ä½“æ¦‚ç‡ã€',
    grantType    int(4)       null comment 'å‘æ”¾å¥–å“æ–¹å¼ã€Œ1:å³æ—¶ã€2:å®šæ—¶[å«æ´»åŠ¨ç»“æŸ]ã€3:äººå·¥ã€',
    grantDate    datetime     null comment 'å‘æ”¾å¥–å“æ—¶é—´',
    extInfo      varchar(128) null comment 'æ‰©å±•ä¿¡æ¯',
    createTime   datetime     null comment 'åˆ›å»ºæ—¶é—´',
    updateTime   datetime     null comment 'ä¿®æ”¹æ—¶é—´',
    constraint strategy_strategyId_uindex
        unique (strategyId)
)
    comment 'ç­–ç•¥é…ç½®';

-- auto-generated definition
create table strategy_detail
(
    id         bigint(11) auto_increment comment 'è‡ªå¢ID'
        primary key,
    strategyId bigint(11)    not null comment 'ç­–ç•¥ID',
    awardId    bigint(11)    null comment 'å¥–å“ID',
    awardCount int           null comment 'å¥–å“æ•°é‡',
    awardRate  decimal(5, 2) null comment 'ä¸­å¥–æ¦‚ç‡',
    createTime datetime      null comment 'åˆ›å»ºæ—¶é—´',
    updateTime datetime      null comment 'ä¿®æ”¹æ—¶é—´'
)
    comment 'ç­–ç•¥æ˜ç»†';

```

lottery_01.sql ~ lottery_02.sql

```sql
create database lottery_01;

-- auto-generated definition
create table user_take_activity
(
    id           bigint    null,
    uId          tinytext  null,
    takeId       bigint    null,
    activityId   bigint    null,
    activityName tinytext  null,
    takeDate     timestamp null,
    takeCount    int       null,
    uuid         tinytext  null,
    createTime   timestamp null,
    updateTime   timestamp null
)
    comment 'ç”¨æˆ·å‚ä¸æ´»åŠ¨è®°å½•è¡¨';

-- auto-generated definition
create table user_take_activity_count
(
    id         bigint    null,
    uId        tinytext  null,
    activityId bigint    null,
    totalCount int       null,
    leftCount  int       null,
    createTime timestamp null,
    updateTime timestamp null
)
    comment 'ç”¨æˆ·æ´»åŠ¨å‚ä¸æ¬¡æ•°è¡¨';

-- auto-generated definition
create table user_strategy_export_001(id           bigint     null,uId          mediumtext null,activityId   bigint     null,orderId      bigint     null,strategyId   bigint     null,strategyType int        null,grantType    int        null,grantDate    timestamp  null,grantState   int        null,awardId      bigint     null,awardType    int        null,awardName    mediumtext null,awardContent mediumtext null,uuid         mediumtext null,createTime   timestamp  null,updateTime   timestamp  null) comment 'ç”¨æˆ·ç­–ç•¥è®¡ç®—ç»“æœè¡¨';
create table user_strategy_export_002(id           bigint     null,uId          mediumtext null,activityId   bigint     null,orderId      bigint     null,strategyId   bigint     null,strategyType int        null,grantType    int        null,grantDate    timestamp  null,grantState   int        null,awardId      bigint     null,awardType    int        null,awardName    mediumtext null,awardContent mediumtext null,uuid         mediumtext null,createTime   timestamp  null,updateTime   timestamp  null) comment 'ç”¨æˆ·ç­–ç•¥è®¡ç®—ç»“æœè¡¨';
create table user_strategy_export_003(id           bigint     null,uId          mediumtext null,activityId   bigint     null,orderId      bigint     null,strategyId   bigint     null,strategyType int        null,grantType    int        null,grantDate    timestamp  null,grantState   int        null,awardId      bigint     null,awardType    int        null,awardName    mediumtext null,awardContent mediumtext null,uuid         mediumtext null,createTime   timestamp  null,updateTime   timestamp  null) comment 'ç”¨æˆ·ç­–ç•¥è®¡ç®—ç»“æœè¡¨';
create table user_strategy_export_004(id           bigint     null,uId          mediumtext null,activityId   bigint     null,orderId      bigint     null,strategyId   bigint     null,strategyType int        null,grantType    int        null,grantDate    timestamp  null,grantState   int        null,awardId      bigint     null,awardType    int        null,awardName    mediumtext null,awardContent mediumtext null,uuid         mediumtext null,createTime   timestamp  null,updateTime   timestamp  null) comment 'ç”¨æˆ·ç­–ç•¥è®¡ç®—ç»“æœè¡¨';


```

<img src="E:\Document\Typoraç¬”è®°\Pictures\image-20230512110639503.png" alt="image-20230512110639503"  />

## ç¬¬05èŠ‚ï¼šæŠ½å¥–ç­–ç•¥é¢†åŸŸæ¨¡å—å¼€å‘

### 5.1éœ€æ±‚

![5-01](E:\Document\Typoraç¬”è®°\Pictures\5-01.png)

ç­–ç•¥å•ç‹¬ç‹¬ç«‹å‡ºæ¥ï¼Œå’Œå¥–å“æ²¡æœ‰å…³ç³»

### 5.2 é¢†åŸŸåŠŸèƒ½ç»“æ„

<img src="E:\Document\Typoraç¬”è®°\Pictures\é¢†åŸŸåŠŸèƒ½ç»“æ„.png" alt="é¢†åŸŸåŠŸèƒ½ç»“æ„"  />

### 5.3 æŠ½å¥–ç®—æ³•å®ç°

![æŠ½å¥–ç®—æ³•](E:\Document\Typoraç¬”è®°\Pictures\æŠ½å¥–ç®—æ³•.png)

![æŠ½å¥–ç®—æ³•2](E:\Document\Typoraç¬”è®°\Pictures\æŠ½å¥–ç®—æ³•2.png)

### 5.4 é—®é¢˜

- `ConcurrentHashMap`

  [ConcurrentHashMap](https://so.csdn.net/so/search?q=ConcurrentHashMap&spm=1001.2101.3001.7020)å’ŒHashMapåŸç†åŸºæœ¬ç±»ä¼¼ï¼Œåªæ˜¯åœ¨HashMapçš„åŸºç¡€ä¸Šéœ€è¦æ”¯æŒå¹¶å‘æ“ä½œï¼Œä¿è¯å¤šçº¿ç¨‹æƒ…å†µä¸‹å¯¹HashMapæ“ä½œçš„å®‰å…¨æ€§ã€‚

- `Springboot å¸¸ç”¨æ³¨è§£`

  - å¯åŠ¨æ³¨è§£ @SpringBootApplication
  - @Component
  - @Slf4j
  - @Data
  - @Resource
  - @Before
  - @PostConstruct

  
